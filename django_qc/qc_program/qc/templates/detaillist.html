{% extends "master.html" %}

{% block title %}
  List of complains
{% endblock %}


{% block content %}
  <div class="container-fluid"> 
    <h5 class="mx-4">Filter</h5>
    <form id="filterdate" name="filterdate" action="">
      <div class="form-group row">
        <label for="startdate" class="col-lg-2 offset-1 col-form-label">Periodic:</label> 
        <label for="startdate" class="col-lg-2 offset-1 col-form-label">Start Date:</label> 
        <label for="enddate" class="col-lg-2 offset-1 col-form-label">End Date:</label> 
      </div>
      <div class="form-group row">
        <div class="col-md-8 col-lg-2 offset-1">
          <select class="form-select" name="periodic" id="periodic" class="form-control">
            <option value=" ">None</option>
            <option value="Monthly">Monthly</option>
            <option value="Yearly">Yearly</option>
          </select>
        </div>
        <div class="col-md-8 col-lg-2 offset-1">
          <input type="date" name="startdate" id="startdate" class="form-control">
        </div>
        <div class="col-md-8 col-lg-2 offset-1">
          <input type="date" name="enddate" id="enddate" class="form-control">
        </div>
        <div class="col-md-8 col-lg-2 offset-1">
          <button type="submit" class="btn btn-success">Filter</button>
        </div>
      </div>
    </form>
  </div>
    <br>
    
  <div class="container-fluid">    
    <h3>Articles</h3>  
    <div class="row">
      <div class="col-lg-12 px-5">
        <table class="table table-striped table-hover" id="detail_list" name='detail_list'>
          <thead class="table-success ">
            <tr>  
              <td>Type</td>
              <td>Customer Name</td>
              <td>Nomor Document</td>
              <td>Document Date</td>
              <td>Product Name</td>
              <td>Process</td>
              <td>Category</td>
              <td>Quantity</td>
              <td>Notes</td>
              <td>Status</td>
            </tr>
          </thead>
          <tbody>
            {% for detail in alldetails%}
            <tr>
              <td>{{detail.complain_type}}</td>
              <td>{{detail.customer_id}}</td>
              <td><a href="/complains/{{detail.complain_id}}">{{detail.nomor_document}}/{{detail.complain_type}}/{{detail.month}}/{{detail.year}}</a></td>
              <td>{{detail.document_date}}</td>
              <td>{{detail.product_id}}</td>
              <td>{{detail.process_name}}</td>
              <td>{{detail.complaincategory_id}}</td>
              <td>{{detail.quantity}}</td>
              <td>{{detail.notes}}</td>
              <td>{{detail.status}}</td>
            </tr>
            {% endfor %}
          </tbody>   
         </table>
        <br>  
        <br>  
        <center><a href="/complains/create/" class="btn btn-primary">Add New Record</a></center>  
      </div>
    </div>
  </div>

  <script>
    $(document).ready(function(){
      $('#detail_list').DataTable();
    })
    $(document).on("submit", '#filterdate', function(e){
      e.preventDefault();
      var startdate = $('input[name="startdate"]').val();
      var enddate = $('input[name="enddate"]').val();
      var periodic = $('select[name="periodic"]').val();
      //$('table.output').empty();
      $.ajax({
          url: "{% url 'filteredarticles' %}",
          type: "GET",
          data: { 'startdate' : startdate, 'enddate' : enddate, 'periodic': periodic},
          dataType: "json",
          success: function(data) {

            $("#detail_list").DataTable().destroy();
            $("#detail_list").find("tbody").empty();
            $('form#filterdate').trigger("reset");
            $.each(data.filteredarticles, function(index, article){
              $("#detail_list > tbody:last-child").append(`
                <tr>
                  <td>${article.complain_type}</td>
                  <td>${article.customer_id}</td>
                  <td><a href="/complains/${article.complain_id}">${article.nomor_document}/${article.complain_type}/${article.month}/${article.year}</a></td>
                  <td>${article.document_date}</td>
                  <td>${article.product_id}</td>
                  <td>${article.process_name}</td>
                  <td>${article.complaincategory_id}</td>
                  <td>${article.quantity}</td>
                  <td>${article.notes}</td>
                  <td>${article.status}</td>
                </tr>
                `)
             
            });
            $("#detail_list").DataTable();
          },
          
      });
      return false;
    });
  </script>
{% endblock %}